<div class="hero">
  <img [src]="getImagenUrl(taller.link_imagen)" alt="{{ taller.titulo }}">
  <div class="hero-overlay">
    <h1>{{ taller.titulo }}</h1>
    <p class="blanco">{{ taller.departamento }} ‚Äî {{ taller.direccion }}</p>
  </div>
  <button (click)="volver()" class="btn-volver">Volver</button>
</div>

<!-- Ribbon Informativa -->
<div class="ribbon">
  <div class="item">‚è± {{ taller.duracion }} horas</div>
  <div class="item">üí∞ S/ {{ taller.precio }}</div>
  <div class="item">üë• Cupos: {{ taller.cupos_libres }}</div>
  <div class="item">üß© Dificultad: {{ taller.dificultad }}</div>
</div>

<div class="layout">

  <!-- COLUMNA IZQUIERDA -->
  <div class="left">

    <!-- Sobre esta experiencia -->
    <section class="section section-experiencia">
      <h2>Sobre esta experiencia</h2>
      <p>{{ taller.descripcion }}</p>
    </section>

    <!-- Incluye / No Incluye -->
    <section class="section section-incluye">
      <div>
        <h3>Incluye</h3>
        <ul>
          <li>Materiales del taller</li>
          <li>Tutor√≠a personalizada</li>
          <li>Tour por el taller</li>
          <li>Fotos profesionales</li>
        </ul>
      </div>

      <div>
        <h3>No incluye</h3>
        <ul>
          <li>Transporte</li>
          <li>Alimentaci√≥n adicional</li>
          <li>Propinas</li>
        </ul>
      </div>
    </section>

    <!-- Itinerario -->
    <section class="section section-itinerario">
      <h3>Itinerario</h3>
      <details *ngFor="let f of fechas">
        <summary>D√≠a: {{ f.dia }} Hora: {{ f.hora }} ‚Äî {{ f.titulo }}</summary>
        <p  [style.white-space]="'pre-line'">Descripcion: {{ f.descripcion }}</p>
        <p>M√°ximas personas del horario: {{ f.maximas_personas }}</p>
        <p>Cantidad de personas registradas: {{ f.personas_registradas }}</p>
      </details>
    </section>

    <!-- Comunidad -->
    <section class="section section-comunidad">
      <h3>Creador</h3>

      <div class="comunidad">
        <img src="assets/images/avatar.png" alt="Artesana">
        <div>
          <h4>{{ perfilPublico?.nombre }}</h4>
          <p>Conoce a la comunidad!!</p>
        </div>
      </div>

      <button class="btn-secundario" [routerLink]="['/perfilpublico/',taller.usua.id_usuario]">
        Ver perfil
      </button>
    </section>

    <!-- Ubicaci√≥n -->
    <section class="section section-ubicacion">
      <h3>Ubicaci√≥n</h3>

      <iframe width="100%" height="280" loading="lazy" style="border-radius: 12px;" [src]="mapaUrl">
      </iframe>
    </section>
    <!-- COMENTARIOS (NUEVA SECCI√ìN) -->
    <section class="section section-comentarios">
      <h2>Dejar un comentario</h2>

      <form [formGroup]="form" (ngSubmit)="registrar()">

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Comentario</mat-label>
          <textarea matInput formControlName="hcomentario"></textarea>
          <mat-error *ngIf="form.controls['hcomentario'].invalid && form.controls['hcomentario'].touched">
            El comentario es obligatorio
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Calificaci√≥n (1 a 5)</mat-label>
          <input type="number" matInput formControlName="hcalificacion">
          <mat-error
            *ngIf="form.controls['hcalificacion'].hasError('required') && form.controls['hcalificacion'].touched">
            La calificaci√≥n es obligatoria
          </mat-error>
          <mat-error
            *ngIf="form.controls['hcalificacion'].hasError('min') || form.controls['hcalificacion'].hasError('max')">
            La calificaci√≥n debe estar entre 1 y 5
          </mat-error>
        </mat-form-field>

        <button mat-raised-button color="primary" class="btn-registrar">Registrar</button>

      </form>
    </section>

    <!-- MODAL -->
    <div class="modal-overlay" *ngIf="comentarioRegistrado">
      <div class="modal-box">
        <h2>¬°Comentario registrado! üéâ</h2>
        <p>Gracias por compartir tu experiencia.</p>
        <button class="btn-modal" (click)="cerrarModal()">Aceptar</button>
      </div>
    </div>
    <h2 class="titulo-comentarios">Comentarios</h2>

    <div *ngIf="comentariosPaginados.length === 0" class="sin-comentarios">
      No hay comentarios todav√≠a.
    </div>

    <div *ngFor="let c of comentariosPaginados" class="comentario-card">

      <!-- Primera l√≠nea: Rol (si aplica) + @username -->
      <div class="comentario-header">
        <span class="rol" *ngIf="c.autoridad === 1">Admin</span>
        <span class="rol creador" *ngIf="c.autoridad === 3">Creador: {{ c.nombre_comunidad }}</span>
        <span class="username">&#64;{{ c.username }}</span>
      </div>

      <!-- Segunda l√≠nea: Calificaci√≥n -->
      <div class="comentario-rating">
        ‚≠ê {{ c.calificacion }}
      </div>

      <!-- Tercera l√≠nea: Comentario -->
      <div class="comentario-texto">
        {{ c.comentario }}
      </div>

    </div>

    <!-- Botones de Paginaci√≥n -->
    <div class="paginacion">
      <button (click)="paginaAnterior()" [disabled]="paginaActual === 1">
        ‚¨Ö Anterior
      </button>

      <span>P√°gina {{ paginaActual }}</span>

      <button (click)="paginaSiguiente()" [disabled]="(paginaActual * itemsPorPagina) >= comentarios.length">
        Siguiente ‚û°
      </button>
    </div>


  </div>

  <!-- COLUMNA DERECHA -->
  <div class="right">
    <div class="card-reserva">

      <div class="precio-box">
        <h2>S/ {{ taller.precio }}</h2>
        <span>por persona</span>
      </div>

      <p class="subtext">Incluye materiales y gu√≠a personalizada</p>

      <hr>

      <div class="campo">
        <label>Horario</label>
        <select [(ngModel)]="horarioSeleccionado">
          <option *ngFor="let h of horarios" [value]="h">{{ h }}</option>
        </select>
      </div>

      <div class="campo">
        <label>Participantes</label>
        <div class="participantes">
          <button class="btn-round" (click)="cambiarParticipantes(-1)">‚àí</button>
          <span class="count">{{ participantes }}</span>
          <button class="btn-round" (click)="cambiarParticipantes(1)">+</button>
        </div>
      </div>

      <div class="total">
        <span>Total:</span>
        <strong>S/ {{ total | number:'1.2-2' }}</strong>
      </div>

      <button class="btn-reservar" (click)="reservar()">
        Reservar experiencia üöÄ
      </button>

      <div class="confianza">
        <p>üîí Pago seguro</p>
        <p>üí¨ Cancelaci√≥n flexible</p>
        <p>ü§ù Apoyas directamente a artesanos locales</p>
      </div>

    </div>
  </div>



</div>